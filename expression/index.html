<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Provides a lightweight and flexible access control list (ACL) implementation for privileges management">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Expression Assertions - zend-permissions-acl</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/styles-288837cc22.css">

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
                <a href="..">zend-permissions-acl</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                
                    <li >
                        <a href="..">zend-permissions-acl</a>
                    </li>
                
                
                
                
                
                    <li >
                        <a href="../usage/">Theory and Usage</a>
                    </li>
                
                
                
                
                
                    <li >
                        <a href="../refining/">Refining ACLs</a>
                    </li>
                
                
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../ownership/">Ownership Assertions</a>
</li>


                        
                            

<li class="active">
    <a href="./">Expression Assertions</a>
</li>


                        
                            

<li >
    <a href="../advanced/">Advanced Usage</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/zend-permissions-acl/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#expression-assertions">Expression Assertions</a></li>
        
            <li><a href="#operands">Operands</a></li>
        
            <li><a href="#operators">Operators</a></li>
        
            <li><a href="#constructors">Constructors</a></li>
        
            <li><a href="#examples">Examples</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../ownership/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../advanced/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="..">zend-permissions-acl</a></li>
  
    
      
        <li>Reference</li>
      
    
  
  <li class="active">Expression Assertions</li>
</ol>

<h1 id="expression-assertions">Expression Assertions</h1>
<ul>
<li>Since 2.7.0</li>
</ul>
<p>Many custom assertions are doing basic comparisons:</p>
<ul>
<li>Equality of a role property to a value or property of the resource.</li>
<li>Other comparisons (<code>&gt;</code>, <code>&lt;</code>, <code>in_array</code>, etc.) of a role property to a value
  or values (potentially a property of the resource).</li>
<li>Regular expressions.</li>
</ul>
<p>While these can be easily accommodated by the <code>CallbackAssertion</code>, such
assertions have one notable problem: they cannot be easily serialized.</p>
<p>To facilitate such assertions, we now provide
<code>Zend\Permissions\Acl\Assertion\ExpressionAssertion</code>. This class provides two
static factory methods for creating an instance, each expecting the following:</p>
<ul>
<li>The left operand</li>
<li>An operator</li>
<li>The right operand</li>
</ul>
<p>When the assertion is executed, it uses the operator to determine how to compare
the two operands, and thus answer the assertion.</p>
<h2 id="operands">Operands</h2>
<p>The operands can be any PHP value.</p>
<p>Additionally, they can be an associative array containing the key
<code>ExpressionAssertion::OPERAND_CONTEXT_PROPERTY</code> (<code>__context</code>), with a string
value.</p>
<p>That value can be one of the following:</p>
<ul>
<li>
<p>A string matching the values "acl", "privilege", "role", or "resource", with
  the latter two being most common. When one of these is provided, the
  corresponding argument to the <code>assert()</code> method will be used.</p>
</li>
<li>
<p>A dot-separated string with the first segment being one of the above values,
  and the second being a property or field of that object. The
  <code>ExpressionAssertion</code> will test for:</p>
</li>
<li>
<p>a method matching <code>get&lt;field&gt;()</code></p>
</li>
<li>a method matching <code>is&lt;field&gt;()</code></li>
<li>a public property named <code>&lt;field&gt;</code></li>
</ul>
<p>in that specific order. In the first two cases, <code>&lt;field&gt;</code> will be normalized
  to WordCase when creating the method name to test.</p>
<h2 id="operators">Operators</h2>
<p><code>ExpressionAssertion</code> supports the following operators:</p>
<pre class="codehilite"><code class="language-php">    const OPERATOR_EQ     = '=';
    const OPERATOR_NEQ    = '!=';
    const OPERATOR_LT     = '&lt;';
    const OPERATOR_LTE    = '&lt;=';
    const OPERATOR_GT     = '&gt;';
    const OPERATOR_GTE    = '&gt;=';
    const OPERATOR_IN     = 'in';
    const OPERATOR_NIN    = '!in';
    const OPERATOR_REGEX  = 'regex';
    const OPERATOR_NREGEX = '!regex';
    const OPERATOR_SAME   = '===';
    const OPERATOR_NSAME  = '!==';</code></pre>

<p>In most cases, these will operate using the operators as listed above, with the
following exceptions:</p>
<ul>
<li><code>OPERATOR_EQ</code> will use <code>==</code> as the comparison operator; <code>OPERATOR_NEQ</code> will
  likewise use <code>!=</code>.</li>
<li><code>OPERATOR_IN</code> and <code>OPERATOR_NIN</code> use <code>in_array()</code> (with the latter negating
  the result), both doing strict comparisons. The right hand operand is expected
  to be the array in which to look for results, and the left hand operand is
  expected to be the needle to look for.</li>
<li><code>OPERATOR_REGEX</code> and <code>OPERATOR_NREGEX</code> will perform a <code>preg_match()</code>
  operation, using the right hand operand as the regular expression, and the
  left hand operand as the value to compare.</li>
</ul>
<h2 id="constructors">Constructors</h2>
<p>The constructor of <code>ExpressionAssertion</code> is private. Instead, you will use one
of two static methods in order to create instances:</p>
<ul>
<li><code>fromProperties($left, $operator, $right)</code></li>
<li><code>fromArray(array $expression)</code> (expects keys for "left", "operator", and "right")</li>
</ul>
<p>When creating expressions manually, the first is generally the best choice. When
storing expressions in configuration or a database, the latter is useful, as you
can pass a row of data at a time to the method to get expression instances.</p>
<h2 id="examples">Examples</h2>
<p>First, we'll define both a role and a resource:</p>
<pre class="codehilite"><code class="language-php">namespace Blog\Entity;

use Zend\Permissions\Acl\Resource\ResourceInterface;
use Zend\Permissions\Acl\Role\RoleInterface;

class BlogPost implements ResourceInterface
{
    public $title;

    public $shortDescription;

    public $content;

    public $author;

    public function __construct(array $data = [])
    {
        foreach ($data as $property =&gt; $value) {
            $this-&gt;$property = $value;
        }
    }

    public function getResourceId()
    {
        return 'blogPost';
    }

    public function getShortDescription()
    {
        return $this-&gt;shortDescription;
    }

    public function getAuthorName()
    {
        return $this-&gt;author ? $this-&gt;author-&gt;username : '';
    }
}

class User implements RoleInterface
{
    public $username;

    public $role = 'guest';

    public $age;

    public function __construct(array $data = [])
    {
        foreach ($data as $property =&gt; $value) {
            $this-&gt;$property = $value;
        }
    }

    public function getRoleId()
    {
        return $this-&gt;role;
    }

    public function isAdult()
    {
        return $this-&gt;age &gt;= 18;
    }
}</code></pre>

<p>Next, let's define some assertions.</p>
<pre class="codehilite"><code class="language-php">use Zend\Permissions\Acl\Assertion\ExpressionAssertion;

// Username of role must be &quot;test&quot;:
// Will access $username property on the role instance.
$isTestUser = ExpressionAssertion::fromProperties(
  [ExpressionAssertion::OPERAND_CONTEXT_PROPERTY =&gt; 'role.username'],
  '===',
  'test'
);


// Role must be at least 18 years old:
// Will execute `isAdult()` on the role instance.
$isOfLegalAge = ExpressionAssertion::fromProperties(
  [ExpressionAssertion::OPERAND_CONTEXT_PROPERTY =&gt; 'role.adult'],
  '===',
  true
);

// Must have edited text:
// Will do a regex comparison on the shortDescription of the blog post
// to ensure we do not have filler text.
$isEditedDescription = ExpressionAssertion::fromArray([
  'left'     =&gt; [ExpressionAssertion::OPERAND_CONTEXT_PROPERTY =&gt; 'resource.shortDescription'],
  'operator' =&gt; '!regex',
  'right'    =&gt; '/lorem ipsum/i',
]);</code></pre>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../ownership/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../advanced/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="https://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2017 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="https://discourse.zendframework.com" class="btn-social btn-outline" alt="Forum" title="Forum"><i class="fa fa-comments"></i></a>
                    <a href="https://zendframework-slack.herokuapp.com" class="btn-social btn-outline" alt="Slack" title="Slack"><i class="fa fa-slack"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script>var base_url = '..';</script>
    <script src="../js/scripts-0b6185f4a5.js"></script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="https://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

</body>


</html>
